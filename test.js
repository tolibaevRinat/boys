const headerContainer = document.querySelector('#header')
const listContainer = document.querySelector('#list')
const submitBtn = document.querySelector('#submit')

const allQuizzesData = {
	1: [
		{
			question: 'Почему образование необходимо обществу?',
			answers: [
				'Только для получения знаний людьми',
				'Для существования и прогрессивного развития общества',
				'Только для экономического производства',
				'Чтобы занять молодёжь',
			],
			correct: 2,
		},
		{
			question: 'Что представляет собой система образования?',
			answers: [
				'Только школы и университеты',
				'Только документы, выданные государством',
				'Взаимодействующие образовательные программы, учреждения и управление',
				'Ученики и учителя',
			],
			correct: 3,
		},
		{
			question: 'На основании каких документов работают образовательные учреждения?',
			answers: [
				'На основании личных желаний',
				'По решению общественности',
				'На основании нормативно-правовых документов, разработанных государством',
				'На основании международных договоров',
			],
			correct: 3,
		},
		{
			question: 'Какой важный закон был принят 10 июля 1992 года?',
			answers: ['Конституция', 'Трудовой кодекс', 'Закон «Об образовании»', 'Гражданский кодекс'],
			correct: 3,
		},
		{
			question: 'Что такое государственный образовательный стандарт?',
			answers: [
				'Утверждённая государством образовательная программа',
				'Система оценок для студентов',
				'Нормативный акт, устанавливающий требования к содержанию образования',
				'Только расписание работы учителей',
			],
			correct: 3,
		},
		{
			question: 'Какие компоненты входят в структуру государственного образовательного стандарта?',
			answers: [
				'Только федеральный компонент',
				'Федеральный, региональный и компонент образовательного учреждения',
				'Только региональный компонент',
				'Только требования учеников',
			],
			correct: 2,
		},
		{
			question: 'Почему федеральный компонент важен в образовательном стандарте?',
			answers: [
				'Он меняется в зависимости от желаний учеников',
				'Он определяет обязательный минимум содержания образования',
				'Он относится только к учителям',
				'Он учитывает только региональные особенности',
			],
			correct: 2,
		},
	],
	2: [
		{
			question: 'Что такое рабочая учебная программа по предмету?',
			answers: [
				'Примерная программа, утверждённая Министерством образования',
				'Программа, разработанная педагогом самостоятельно на основе методических рекомендаций и примерных программ',
				'Учебник по предмету',
				'План проведения внеурочных мероприятий',
			],
			correct: 2,
		},
		{
			question: 'Какова основная цель рабочей учебной программы?',
			answers: [
				'Организация внеклассных мероприятий',
				'Планирование, организация и управление педагогическим процессом по предмету',
				'Утверждение учебников',
				'Контроль посещаемости учащихся',
			],
			correct: 2,
		},
		{
			question:
				'Какие требования предъявляются к педагогам при составлении рабочей учебной программы?',
			answers: [
				'Знать содержание учебного курса и результаты усвоения программы',
				'Использовать только готовые программы без изменений',
				'Работать без учета возраста и возможностей учащихся',
				'Не учитывать требования ФГОС',
			],
			correct: 1,
		},
		{
			question: 'Что из перечисленного входит в структуру учебной программы?',
			answers: [
				'Положение о дисциплине',
				'Титульный лист, пояснительная записка, тематический план, результаты освоения дисциплины',
				'Учебный план школы в целом',
				'Список учебников',
			],
			correct: 2,
		},
		{
			question: 'Как педагог может изменять учебную программу?',
			answers: [
				'Педагог не имеет права вносить изменения',
				'Вносить корректировки с учетом особенностей класса и требований примерной программы',
				'Менять учебную программу по своему усмотрению без ограничений',
				'Изменять только титульный лист',
			],
			correct: 2,
		},
		{
			question: 'Какие факторы должен учитывать педагог при составлении учебной программы?',
			answers: [
				'Только требования ГОС',
				'Требования ГОС, примерные программы, возраст и возможности учащихся, материально-технические возможности школы',
				'Только пожелания родителей',
				'Только количество учебных часов',
			],
			correct: 2,
		},
		{
			question:
				'Какая из этих характеристик НЕ относится к методическим требованиям к учебной программе?',
			answers: [
				'Соответствие признакам нормативного документа',
				'Максимальное раскрытие целей обучения',
				'Возможность произвольного изменения всех разделов программы',
				'Целостность и системность содержания',
			],
			correct: 3,
		},
	],
	3: [
		{
			question: 'Что такое таксономия в педагогике?',
			answers: [
				'Наука о классификации живых организмов',
				'Теория и система классификации целей обучения и процессов познания',
				'Методика проведения уроков',
				'Учебник по биологии',
			],
			correct: 2,
		},
		{
			question: 'Сколько уровней познавательной деятельности выделяет таксономия Блума?',
			answers: ['Четыре', 'Шесть', 'Пять', 'Три'],
			correct: 2,
		},
		{
			question: 'Какой из уровней НЕ входит в таксономию Блума?',
			answers: ['Знание', 'Анализ', 'Синтез', 'Игнорирование'],
			correct: 4,
		},
		{
			question: 'Какая группа целей обучения в таксономии Блума имеет первостепенное значение?',
			answers: ['Аффективные', 'Познавательные', 'Психомоторные', 'Социальные'],
			correct: 2,
		},
		{
			question: 'В чем отличие таксономии В. Оконя от таксономии Блума?',
			answers: [
				'Оконь выделяет шесть уровней',
				'Оконь объединяет анализ и синтез в один уровень',
				'Оконь убирает уровень понимания',
				'Оконь добавляет эмоциональные цели',
			],
			correct: 2,
		},
		{
			question: 'Почему в таксономии Блума анализ и синтез располагаются после понимания?',
			answers: [
				'Потому что анализ и синтез не важны для понимания',
				'Потому что понимание невозможно без знания элементов и их связей, которые выявляются при анализе и синтезе',
				'Потому что синтез легче анализа',
				'Потому что это было сделано случайно',
			],
			correct: 2,
		},
		{
			question: 'Что позволяет четко сформулированная цель образования в системе образования?',
			answers: [
				'Избегать контроля знаний',
				'Отбирать содержание обучения и делить его на методические единицы и уроки',
				'Устранять все уровни обучения',
				'Делать уроки одинаковыми для всех',
			],
			correct: 2,
		},
	],
	4: [
		{
			question: 'Какова основная цель оценивания учебных достижений?',
			answers: [
				'Определение соответствия полученных знаний плановым показателям',
				'Создание соревнования между учениками',
				'Повышение дисциплины в классе',
				'Увеличение количества домашних заданий',
			],
			correct: 1,
		},
		{
			question: 'Какая система оценивания традиционно используется в отечественной школе?',
			answers: [
				'10-балльная система',
				'5-балльная система',
				'3-балльная система',
				'Оценивание словами',
			],
			correct: 2,
		},
		{
			question:
				'Какой балл по традиционной 5-балльной системе практически не использовался и носил скорее дисциплинарный характер?',
			answers: ['2', '3', '1', '5'],
			correct: 3,
		},
		{
			question: 'Какие виды оценивания должен применять учитель для эффективной оценки?',
			answers: [
				'Текущая, промежуточная, итоговая',
				'Суммативное, формативное, диагностическое',
				'Только итоговая',
				'Оценка по внешнему виду',
			],
			correct: 2,
		},
		{
			question: 'В чем недостаток традиционного сравнения достижений учеников?',
			answers: [
				'Повышает мотивацию учеников',
				'Не дает обратной связи для коррекции и снижает мотивацию',
				'Улучшает качество выполнения заданий',
				'Способствует здоровой конкуренции',
			],
			correct: 2,
		},
		{
			question: 'Почему важно знакомить учащихся с критериями оценки перед выполнением задания?',
			answers: [
				'Чтобы уменьшить время выполнения работы',
				'Чтобы учащиеся понимали, что и как будет оцениваться',
				'Чтобы повысить страх перед оценкой',
				'Чтобы сократить количество заданий',
			],
			correct: 2,
		},
		{
			question: 'Что характерно для формативного оценивания?',
			answers: [
				'Проводится один раз в конце учебного периода',
				'Позволяет учащимся исправлять ошибки и получать обратную связь',
				'Используется только для выставления итоговых оценок',
				'Не требует участия учащихся',
			],
			correct: 2,
		},
	],
	5: [
		{
			question:
				'Какова главная причина возникновения проблемы диагностики личностных результатов в образовательном процессе?',
			answers: [
				'Отсутствие традиционной системы оценивания',
				'Новые требования ГОС к оценке метапредметных и личностных результатов',
				'Недостаток квалифицированных педагогов',
				'Низкий уровень знаний учащихся',
			],
			correct: 2,
		},
		{
			question: 'Какой из следующих недостатков относится к традиционной системе оценивания?',
			answers: [
				'Унифицированные требования к оцениванию',
				'Вовлечение всех участников образовательного процесса',
				'Отсутствие единой системы и разные подходы к оценке',
				'Высокая мотивация учащихся',
			],
			correct: 3,
		},
		{
			question: 'Какое из утверждений о критериальном оценивании является верным?',
			answers: [
				'Сравнивает достижения учащихся только друг с другом',
				'Основано на четко определенных критериях, выработанных коллективно',
				'Исключает участие учителя в оценивании',
				'Используется только для итоговых экзаменов',
			],
			correct: 2,
		},
		{
			question: 'Что характерно для формирующего оценивания?',
			answers: [
				'Проводится после окончания курса',
				'Анализирует знания и умения учащихся в процессе обучения и дает обратную связь',
				'Не связано с мотивацией учащихся',
				'Исключает сравнение с предыдущими результатами',
			],
			correct: 2,
		},
		{
			question: 'В чем преимущество критериальной системы оценивания для учащихся?',
			answers: [
				'Повышается чувство страха перед проверкой знаний',
				'Учащиеся заранее знают критерии и могут контролировать свой прогресс',
				'Оценки выставляются произвольно',
				'Отсутствие обратной связи',
			],
			correct: 2,
		},
		{
			question:
				'Какая цель стоит перед учителем согласно требованиям ГОС в части воспитания личности?',
			answers: [
				'Воспитать ученика с активной жизненной позицией и способностью к самоорганизации',
				'Поддерживать только академические знания учащихся',
				'Ограничить участие учащихся в учебном процессе',
				'Избегать социализации учащихся',
			],
			correct: 1,
		},
		{
			question: 'Как критериальная система оценивания влияет на уровень тревожности учащихся?',
			answers: [
				'Повышает тревожность и стресс',
				'Не влияет на уровень тревожности',
				'Снижает страх перед проверкой знаний по сравнению с традиционной системой',
				'Усиливает конкуренцию между учениками',
			],
			correct: 3,
		},
	],
}

let currentQuizId = null
let questions = []

let score = 0
let questionIndex = 0

// Функция для перемешивания массива (Fisher-Yates shuffle)
function shuffleArray(array) {
	for (let i = array.length - 1; i > 0; i--) {
		const j = Math.floor(Math.random() * (i + 1))
		;[array[i], array[j]] = [array[j], array[i]] // ES6 swap
	}
}

document.addEventListener('DOMContentLoaded', () => {
	const urlParams = new URLSearchParams(window.location.search)
	currentQuizId = urlParams.get('id')

	if (currentQuizId === '16') {
		// Предполагается, что '16' - это ID для "смешанного" теста
		// Собираем все вопросы из всех тестов в один массив
		let allQuestions = []
		for (const quizId in allQuizzesData) {
			allQuestions = allQuestions.concat(allQuizzesData[quizId])
		}

		// Перемешиваем все вопросы
		shuffleArray(allQuestions)

		// Берем первые 30 вопросов (или меньше, если вопросов меньше 30)
		questions = allQuestions.slice(0, 20)

		clearPage()
		showQuestion()
		submitBtn.onclick = checkAnswer
		submitBtn.style.display = 'inline-block'
	} else if (currentQuizId && allQuizzesData[currentQuizId]) {
		// Оригинальная логика для обычных тестов (id 1-5 в данном случае)
		let originalQuestions = [...allQuizzesData[currentQuizId]]
		shuffleArray(originalQuestions)
		questions = originalQuestions

		clearPage()
		showQuestion()
		submitBtn.onclick = checkAnswer
		submitBtn.style.display = 'inline-block'
	} else {
		headerContainer.innerHTML = '<h2 class="title">Test topilmadi</h2>'
		listContainer.innerHTML = "<p>Noto‘g‘ri ID berildi yoki test ma'lumotlari mavjud emas.</p>"
		submitBtn.style.display = 'none'
	}
})

function clearPage() {
	headerContainer.innerHTML = ''
	listContainer.innerHTML = ''
}

function showQuestion() {
	if (questionIndex < questions.length) {
		const currentQuestion = questions[questionIndex]

		const headerTemplate = `<h2 class="title">%title%</h2>`
		const title = headerTemplate.replace('%title%', currentQuestion.question)
		headerContainer.innerHTML = title

		let answerOptions = currentQuestion.answers.map((answerText, index) => {
			return {
				text: answerText,
				originalValue: index + 1,
			}
		})

		shuffleArray(answerOptions)

		listContainer.innerHTML = ''

		for (const option of answerOptions) {
			const questionTemplate = `
							<li>
									<label>
											<input value="%value%" type="radio" class="answer" name="answer" />
											<span>%answer%</span>
									</label>
							</li>`

			let answerHTML = questionTemplate
				.replace('%answer%', option.text)
				.replace('%value%', option.originalValue)

			listContainer.innerHTML += answerHTML
		}
	} else {
		showResults()
	}
}

function checkAnswer() {
	let checkedRadio = listContainer.querySelector('input[name="answer"]:checked')

	if (!checkedRadio) {
		submitBtn.blur()
		return
	}
	const userAnswer = parseInt(checkedRadio.value)
	const correctAnswerValue = questions[questionIndex].correct

	if (userAnswer === correctAnswerValue) {
		score++
	}

	if (questionIndex < questions.length - 1) {
		questionIndex++
		clearPage()
		showQuestion()
	} else {
		clearPage()
		showResults()
	}
}

function showResults() {
	const resultsTemplate = `
	<h2 class="title">%title%</h2>
	<h3 class="summary">%message%</h3>
	<p class="result">%result%</p>
`

	let title, message
	const percentage = (score * 100) / questions.length

	// Используем русский язык для результатов, так как вопросы на русском
	if (score === questions.length) {
		title = 'Поздравляем!'
		message = `Вы ответили правильно на все вопросы.`
	} else if (percentage >= 50) {
		title = 'Хороший результат'
		message = `Вы ответили правильно более чем на половину вопросов.`
	} else {
		title = 'Не очень хорошо'
		message = `Вы ответили правильно менее чем на половину вопросов.`
	}

	let result = `Правильных ответов: ${score} из ${questions.length}`

	const finalMessage = resultsTemplate
		.replace('%title%', title)
		.replace('%message%', message)
		.replace('%result%', result)

	headerContainer.innerHTML = finalMessage

	submitBtn.blur()
	submitBtn.innerText = 'Пройти тест еще раз' // Текст кнопки на русском
	submitBtn.onclick = () => {
		history.go()
	}
}
